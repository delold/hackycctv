(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,n){e.exports={item:"Home_item__2f97p",header:"Home_header__26qSh",color:"Home_color__2TXZF",name:"Home_name__2FCrF",video:"Home_video__2AOIV",list:"Home_list__RcQ_T"}},3:function(e,t,n){e.exports={main:"Scrobber_main__2ygog",timeline:"Scrobber_timeline__1ra57",center:"Scrobber_center__2Traq",timewrapper:"Scrobber_timewrapper__c7PZf",timeoffset:"Scrobber_timeoffset__3gJ0p",live:"Scrobber_live__14j6k",pill:"Scrobber_pill__3l8yN",margin:"Scrobber_margin__nH10P",cover:"Scrobber_cover__Rh9cd",time:"Scrobber_time__1lHGn",calendar:"Scrobber_calendar__3RAPe",top:"Scrobber_top__2wWJ8",back:"Scrobber_back__22_Cc",info:"Scrobber_info__21Xn4",name:"Scrobber_name__1I--o",color:"Scrobber_color__17LlG"}},30:function(e,t,n){e.exports={camera:"Camera_camera__3kN0E",log:"Camera_log__26FCI"}},31:function(e,t,n){},32:function(e,t,n){e.exports={canvas:"Slider_canvas__1GiME"}},34:function(e,t,n){e.exports=n(49)},39:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(39),n(26)),l=n(4),u=n(16),s=n(14),m=Object(a.createContext)({streams:[]}),f=n(15),d=n.n(f),h=window.localStorage.getItem("host")||window.location.hostname,v="http://".concat(h,":").concat(80),p=("ws://".concat(h,":").concat(80),["#EB5757","#F2994A","#F2C94C","#219653","#6FCF97","#2F80ED","#2D9CDB","#56CCF2","#9B51E0"]),b=n(27),g=function(e){var t=e.src,n=e.alt,o=Object(b.a)(e,["src","alt"]),c=Object(a.useState)(Date.now()),i=Object(l.a)(c,2),u=i[0],s=i[1],m=Object(a.useRef)();return Object(a.useEffect)(function(){return m.current=window.setInterval(function(){s(Date.now())},15e3),function(){window.clearInterval(m.current)}},[]),r.a.createElement("img",Object.assign({src:"".concat(t,"?q=").concat(u),alt:n},o))},w=function(){return r.a.createElement("div",null,r.a.createElement("div",{className:d.a.list},r.a.createElement(m.Consumer,null,function(e){return e.streams.map(function(e){var t=e.key,n=e.name,a=e.color;return r.a.createElement(u.b,{to:"/camera/".concat(t),className:d.a.item},r.a.createElement("section",{className:d.a.header},r.a.createElement("h2",{className:d.a.name},n),r.a.createElement("span",{className:d.a.color,style:{backgroundColor:a}})),r.a.createElement("div",{className:d.a.video},r.a.createElement(g,{src:"".concat(v,"/frame/").concat(t),alt:n})))})})))},E=n(5),_=n(9),j=n(7),S=n(6),y=n(8),O=n(30),M=n.n(O),C=n(18),D=n.n(C),N=n(31),k=n.n(N),T=function(e){function t(){var e,n;Object(E.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(j.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).hls=null,n.timer=null,n.ref=null,n.videoRef=function(e){n.ref=e,n.handlePlayback()},n.autoplay=function(){n.ref&&n.ref.play()},n.handlePlayback=function(){var e=n.props.source;console.log(e),e&&n.ref&&(null!==n.timer&&clearTimeout(n.timer),D.a.isSupported()?(n.hls&&(n.ref.pause(),n.hls.destroy()),n.hls=new D.a,n.hls.loadSource(e),n.hls.attachMedia(n.ref),n.hls.on(D.a.Events.MANIFEST_PARSED,function(){n.timer=setTimeout(n.autoplay,300)})):(n.ref.src=e,n.timer=setTimeout(n.autoplay,300)))},n}return Object(y.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){this.handlePlayback()}},{key:"componentDidUpdate",value:function(e){e.source!==this.props.source&&this.handlePlayback()}},{key:"componentWillUnmount",value:function(){null!==this.timer&&clearTimeout(this.timer),this.ref&&this.ref.pause(),this.hls&&this.hls.destroy()}},{key:"render",value:function(){return r.a.createElement("video",{className:k.a.video,ref:this.videoRef,autoPlay:!0,muted:!0,playsInline:!0})}}]),t}(a.Component),x=function(e){e.delayLog;var t=Object(a.useRef)(null);return Object(a.useLayoutEffect)(function(){if(t.current){var e,n,a=new MediaSource,r=[],o=t.current,c=!1,i=null,l=null,u=null,s=0;return a.sourceBuffers.addEventListener("addsourcebuffer",function(){!function(e){var t=!1;(i=new WebSocket(e)).onopen=function(){i&&i.send("init")},i.binaryType="arraybuffer",i.onmessage=function(e){var n=e.data;try{if(!l)return;l.updating||r.length>0?r.push(n):l.appendBuffer(n),!1===t&&null!=i&&(t=!0,i.send("ack"))}catch(a){console.error(a)}},i.onerror=function(){return i&&i.close()},i.onclose=function(){c||(window.clearTimeout(void 0),window.setTimeout(function(){},1e3))}}("ws://localhost:8081")}),a.addEventListener("sourceopen",function(){a.duration=0,(l=a.addSourceBuffer('video/mp4; codecs="avc1.42001f"')).mode="sequence",l.onupdateend=function(){if(l&&r.length>0&&!l.updating){console.log("Adding new fragment",r.length);var e=r.shift();e&&(console.log("appending item"),l.appendBuffer(e))}},l.onerror=function(e){return console.error(e)},l.onabort=function(e){return console.error(e)}}),e=window.URL.createObjectURL(a),o.src=e,n=window.setInterval(function(){if(l){var e=o.currentTime;if(console.log(o.readyState,o.seekable,o.paused),0!==e)return u=null,void(s=0);if(!(o.readyState>2))if(o.paused)o.play();else u||(u=performance.now()),window.performance.now()-u>1e3&&(console.log("Nudging playback"),function(){if(o){var e=o.currentTime+.1*(s+=1);o.currentTime=e}}())}},100),function(){c=!0,i&&i.close(),window.clearTimeout(void 0),n&&window.clearInterval(n),e&&window.URL.revokeObjectURL(e)}}},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("video",{ref:t,controls:!0})))},H=n(13),R=n.n(H),Y=function(e){return function(){try{navigator.vibrate(200)}catch(t){}return e.apply(void 0,arguments)}},L=n(3),F=n.n(L),W=n(33),B=n(32),I=n.n(B),P=function(e){var t=e.value,n=e.color,o=e.onScrollEnd,c=e.onScroll,i=Object(a.useRef)({onDrag:function(){},onDragEnd:function(){},onWheel:function(){},onWheelEnd:function(){}}),l=Object(a.useRef)(null),u=Object(W.a)({onWheel:function(e){i.current.onWheel&&i.current.onWheel(e)},onWheelEnd:function(e){i.current.onWheelEnd&&i.current.onWheelEnd(e)},onDrag:function(e){i.current.onDrag&&i.current.onDrag(e)},onDragEnd:function(e){i.current.onDragEnd&&i.current.onDragEnd(e)}});return Object(a.useLayoutEffect)(function(){var e=null,a=-Math.floor(t/1e3),r=0,u=function(e){if(e&&e.parentElement){var t=e.getContext("2d");if(t){var o=e.parentElement.getBoundingClientRect();e.width=o.width,e.height=o.height;!function(a){var r=e.getBoundingClientRect().width,o=R()(),c=o.clone().add(a,"seconds"),i=Math.min(604800,o.diff(c.clone().startOf("day"),"second"));!function(a,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=e.getBoundingClientRect(),i=c.width,l=c.height;t.lineWidth=10,t.strokeStyle=n,t.beginPath(),t.moveTo(Math.min(i,Math.max(0,a+o)),l/2),t.lineTo(Math.min(i,Math.max(0,r+o)),l/2),t.closePath(),t.stroke()}(-(Math.max(0,o.diff(c.clone().endOf("day"),"second"))+a),-(i+a),r/2)}(a+r)}}},s=function(e){r=e,r=Math.min(-a,Math.max(-604800-a,r)),c(1e3*-(a+r))},m=function(){o(1e3*-(a+r))};return i.current={onDrag:function(e){return s(-e.delta[0])},onWheel:function(e){return s(e.delta[0]||-e.delta[1])},onDragEnd:function(){return m()},onWheelEnd:function(){return m()}},function t(){u(l.current),e=window.requestAnimationFrame(t)}(),function(){e&&window.cancelAnimationFrame(e)}},[t,n,c,o]),r.a.createElement("div",{className:I.a.canvas},r.a.createElement("canvas",Object.assign({ref:l,height:100},u())))},A=function(e){var t,n=e.onShift,o=e.stream,c=Object(a.useState)(Date.now()),i=Object(l.a)(c,2),s=i[0],m=i[1],f=Object(a.useState)(0),d=Object(l.a)(f,2),h=d[0],v=d[1],p=Object(a.useState)(0),b=Object(l.a)(p,2),g=b[0],w=b[1],E=Object(a.useRef)({}),_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=Object(a.useState)(!0),n=Object(l.a)(t,2),r=n[0],o=n[1],c=Object(a.useRef)(function(){return o(!0)}),i=Object(a.useRef)(function(){return o(!1)});return Object(a.useEffect)(function(){var t=null;return i.current=function(){null!==t&&window.clearTimeout(t),o(!1)},c.current=function(){null!==t&&window.clearTimeout(t),o(!0),t=window.setTimeout(i.current,e)},c.current(),function(){null!==t&&window.clearTimeout(t)}},[e]),{visible:r,show:c,hide:i}}(1e4),j=_.visible,S=_.show;t=function(e){return m(e)},Object(a.useLayoutEffect)(function(){var e=null;return function n(){var a=Date.now();t(a),null!==e&&window.clearTimeout(e),e=window.setTimeout(n,Math.max(1e3-new Date(a).getMilliseconds(),0))}(),function(){null!==e&&window.clearTimeout(e)}},[t]),Object(a.useEffect)(function(){var e=null;return E.current.commitShift=function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.max(0,Math.min(6048e5,t));v(r),e&&window.clearTimeout(e),a?(w(r),n(Math.ceil(r/1e3))):e=window.setTimeout(function(){w(r),n(Math.ceil(r/1e3))},100)},E.current.scrollChange=function(e){E.current.commitShift&&E.current.commitShift(e,!0)},E.current.timeChange=function(e){var t=e.split(":").map(function(e){return Number.parseInt(e,10)}),n=Object(l.a)(t,2),a=n[0],r=n[1];console.log(a,r);var o=R()(),c=o.clone().subtract(g,"milliseconds").hours(a).minutes(r);E.current.commitShift&&E.current.commitShift(o.diff(c),!0)},E.current.dateChange=function(e){if(e){var t=R()(),n=R()().subtract(g,"milliseconds"),a=R()(e).hours(n.hours()).minutes(n.minutes()).seconds(n.seconds()).milliseconds(n.milliseconds());console.log(g,a.format("YYYY-MM-DD HH:mm:ss")),E.current.commitShift&&E.current.commitShift(t.diff(a),!0)}},function(){e&&window.clearTimeout(e)}},[g,n]);var y=R()(new Date(s-h)),O=s-6048e5;O-=O%6e4;var M=s;M+=6e4-M%6e4;var C=R()(new Date(O)),D=R()(new Date(M));return r.a.createElement("div",{className:F.a.main,style:{opacity:j?1:0},onTouchStart:S.current,onMouseMove:S.current},r.a.createElement("div",{className:F.a.top},r.a.createElement(u.b,{to:"/",className:F.a.back},r.a.createElement("svg",{viewBox:"0 0 29 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M25 9.17424V11.8258H9.09091L16.3826 19.1174L14.5 21L4 10.5L14.5 0L16.3826 1.88258L9.09091 9.17424H25Z",fill:"currentColor"}))),r.a.createElement("div",{className:F.a.info},r.a.createElement("span",{className:F.a.color,style:{backgroundColor:o&&o.color}}),r.a.createElement("span",{className:F.a.name},o&&o.name))),r.a.createElement("div",{className:F.a.timeline},r.a.createElement("div",{className:F.a.center},r.a.createElement("div",{className:[F.a.timewrapper].join(" ")},r.a.createElement("div",{onClick:function(){return E.current.scrollChange&&Y(E.current.scrollChange)(0)},className:[F.a.timeoffset].join(" ")},h?function(e){var t=Math.abs(e),n=Math.floor(t/1e3)%60,a=Math.floor(t/1e3/60)%60,r=Math.floor(t/1e3/60/60)%24,o=Math.floor(t/1e3/60/60/24),c=[];return(n>0||a>0||r>0)&&c.unshift("".concat(n.toFixed(0).padStart(2,"0"),"s")),(a>0||r>0)&&c.unshift("".concat(a.toFixed(0).padStart(2,"0"),"m")),r>0&&c.unshift("".concat(r.toFixed(0).padStart(2,"0"),"h")),o>0&&c.unshift("".concat(o,"d")),"".concat(Math.sign(e)<0?"-":"").concat(c.join(" "))}(-h):r.a.createElement("span",{className:[F.a.live].join(" ")},"\u017div\u011b")),r.a.createElement("div",{className:[F.a.pill,F.a.margin].join(" ")},r.a.createElement("input",{className:F.a.cover,onChange:function(e){return E.current.timeChange&&Y(E.current.timeChange)(e.target.value)},value:y.format("HH:mm"),min:C.format("HH:mm"),max:D.format("HH:mm"),type:"time"}),r.a.createElement("span",{className:[F.a.time].join(" ")},y.format("HH:mm:ss")))),r.a.createElement("div",{className:[F.a.pill].join(" ")},r.a.createElement("input",{className:F.a.cover,onChange:function(e){return E.current.dateChange&&Y(E.current.dateChange)(e.target.valueAsDate)},value:y.format("YYYY-MM-DD"),min:C.format("YYYY-MM-DD"),max:D.format("YYYY-MM-DD"),type:"date"}),r.a.createElement("span",{className:[F.a.calendar].join(" ")},y.format("DD. MMMM YYYY"))))),r.a.createElement(P,{onScroll:function(e){return v(e)},onScrollEnd:function(e){return E.current.scrollChange&&Y(E.current.scrollChange)(e)},value:g,color:o.color}))},U=function(e){function t(){var e,n;Object(E.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(j.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={from:0,to:0,shift:0,showTools:!1},n.generateUrl=function(e){var t=e.name,n=e.from,a=e.to,r=e.shift,o="".concat(v,"/data/").concat(t,"/"),c="stream.m3u8",i=[];return n>0?(c="slice.m3u8",i.push("from=".concat(n)),a>0&&n<a&&i.push("to=".concat(a))):r>0&&i.push("shift=".concat(r)),o+=c,i.length>0&&(o+="?"+i.join("&")),o},n.handleShiftChange=function(e){console.log(e),n.setState({shift:e})},n}return Object(y.a)(t,e),Object(_.a)(t,[{key:"componentWillUpdate",value:function(e){this.props.name!==e.name&&this.setState({from:0,to:0,shift:0})}},{key:"render",value:function(){var e=this.props,t=e.name,n=e.streams,a=this.state,o=a.from,c=a.to,i=a.shift,l=this.generateUrl({name:t,from:o,to:c,shift:i}),u=n.find(function(e){return e.key===t});return r.a.createElement("div",{className:M.a.camera},l&&r.a.createElement(T,{source:l}),!l&&r.a.createElement(x,{delayLog:function(e){return console.log(e)}}),u&&r.a.createElement(A,{onShift:this.handleShiftChange,stream:u}))}}]),t}(a.Component),q=function(){var e=Object(a.useState)([]),t=Object(l.a)(e,2),n=t[0],o=t[1];return Object(a.useEffect)(function(){fetch("".concat(v,"/streams")).then(function(e){return e.json()}).then(function(e){var t=e.data;return o(t.map(function(e,t){return Object(i.a)({},e,{color:p[t%p.length]})}))})},[]),r.a.createElement(u.a,null,r.a.createElement(m.Provider,{value:{streams:n}},r.a.createElement("div",{id:"app"},r.a.createElement(s.a,{exact:!0,path:"/",component:w}),r.a.createElement(s.a,{path:"/camera/:name",render:function(e){var t=e.match;return r.a.createElement(U,{name:t.params.name,streams:n})}}))))};c.a.render(r.a.createElement(q,null),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.1b37915f.chunk.js.map