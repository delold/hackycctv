{"version":3,"sources":["routes/Home/Home.module.css","components/Scrobber/Scrobber.module.css","routes/Camera/Camera.module.css","components/Slider/Slider.module.css","utils/dataProvider.ts","utils/constants.ts","components/RefreshImg/RefreshImg.tsx","routes/Home/Home.tsx","components/HLSArchive/HLSArchive.tsx","components/MediaSourceLive/MediaSourceLive.tsx","utils/vibrateDecorator.ts","components/Slider/Slider.tsx","components/Scrobber/Scrobber.tsx","routes/Camera/Camera.tsx","App.tsx","index.tsx"],"names":["module","exports","item","header","color","name","video","list","main","timeline","center","timewrapper","timeoffset","live","pill","margin","cover","time","calendar","top","back","info","camera","log","canvas","provider","createContext","streams","HOST","window","localStorage","getItem","location","hostname","API_URL","concat","COLORS","RefreshImg","_ref","src","alt","props","Object","objectWithoutProperties","_useState","useState","Date","now","_useState2","slicedToArray","session","setSession","ref","useRef","useEffect","current","setInterval","clearInterval","react_default","a","createElement","assign","Home","className","styles","dataProvider","Consumer","map","_ref2","key","react_router_dom","to","style","backgroundColor","RefreshImg_RefreshImg","HLSArchive","hls","timer","videoRef","_this","handlePlayback","autoplay","play","source","console","clearTimeout","Hls","isSupported","pause","destroy","loadSource","attachMedia","on","Events","MANIFEST_PARSED","setTimeout","this","oldProps","autoPlay","muted","playsInline","Component","MediaSourceLive","delayLog","useLayoutEffect","objectUrl","tickTimer","mediaSource","MediaSource","frameBuffer","media","closing","socket","sourceBuffer","stallTime","nudgeRetry","sourceBuffers","addEventListener","url","sendAck","WebSocket","onopen","send","binaryType","onmessage","data","updating","length","push","appendBuffer","err","error","onerror","close","onclose","undefined","createSocket","duration","addSourceBuffer","mode","onupdateend","shift","onabort","URL","createObjectURL","currentPos","currentTime","readyState","seekable","paused","performance","targetTime","nudgePlayback","revokeObjectURL","Fragment","controls","vibrateDecorator","callback","navigator","vibrate","apply","arguments","Slider","value","onScrollEnd","onScroll","callbackRef","onDrag","onDragEnd","onWheel","onWheelEnd","canvasRef","bind","useGesture","event","animationId","valueOffset","Math","floor","userOffset","draw","parentElement","ctx","getContext","parentRect","getBoundingClientRect","width","height","moment","shiftedNow","clone","add","startDayX","min","diff","startOf","xFrom","xTo","viewOffset","_canvas$getBoundingCl","lineWidth","strokeStyle","beginPath","moveTo","max","lineTo","closePath","stroke","drawLine","endOf","drawDayBoundedLine","handleScroll","delta","handleScrollEnd","tick","requestAnimationFrame","cancelAnimationFrame","Scrobber","onShift","stream","_useState3","_useState4","setCurrent","_useState5","_useState6","setShift","_useState7","_useState8","commitedShift","setCommitedShift","callbacks","_useVisibleTimer","delay","visible","setVisible","show","hide","useVisibleTimer","getMilliseconds","handleTimeout","commitShift","newShift","noWait","MAX_LENGTH","ceil","scrollChange","timeChange","_value$split$map","split","Number","parseInt","_value$split$map2","hours","minutes","past","subtract","dateChange","seconds","milliseconds","format","date","minRangeRounded","maxRangeRounded","minDate","maxDate","opacity","onTouchStart","onMouseMove","viewBox","fill","xmlns","d","join","onClick","absTime","abs","days","result","unshift","toFixed","padStart","sign","formatTime","onChange","e","target","type","valueAsDate","Slider_Slider","Camera","state","from","debugDelay","showTools","generateUrl","baseUrl","params","handleShiftChange","setState","newProps","_this2","_this$props","_this$state","find","HLSArchive_HLSArchive","components_Scrobber_Scrobber","App","setStreams","fetch","then","json","index","objectSpread","Provider","id","react_router","exact","path","component","render","match","Camera_Camera","ReactDOM","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.d0732804.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"item\":\"Home_item__2f97p\",\"header\":\"Home_header__26qSh\",\"color\":\"Home_color__2TXZF\",\"name\":\"Home_name__2FCrF\",\"video\":\"Home_video__2AOIV\",\"list\":\"Home_list__RcQ_T\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"Scrobber_main__2ygog\",\"timeline\":\"Scrobber_timeline__1ra57\",\"center\":\"Scrobber_center__2Traq\",\"timewrapper\":\"Scrobber_timewrapper__c7PZf\",\"timeoffset\":\"Scrobber_timeoffset__3gJ0p\",\"live\":\"Scrobber_live__14j6k\",\"pill\":\"Scrobber_pill__3l8yN\",\"margin\":\"Scrobber_margin__nH10P\",\"cover\":\"Scrobber_cover__Rh9cd\",\"time\":\"Scrobber_time__1lHGn\",\"calendar\":\"Scrobber_calendar__3RAPe\",\"top\":\"Scrobber_top__2wWJ8\",\"back\":\"Scrobber_back__22_Cc\",\"info\":\"Scrobber_info__21Xn4\",\"name\":\"Scrobber_name__1I--o\",\"color\":\"Scrobber_color__17LlG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"camera\":\"Camera_camera__3kN0E\",\"log\":\"Camera_log__26FCI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvas\":\"Slider_canvas__1GiME\"};","import { createContext } from 'react'\n\nconst provider = createContext({ streams: [] })\nexport default provider","const HOST = window.localStorage.getItem('host') || window.location.hostname\nconst PORT = 80\n\nexport const API_URL = `http://${HOST}:${PORT}`\nexport const WS_URL = `ws://${HOST}:${PORT}`\nexport const COLORS = [\n  '#EB5757', '#F2994A', '#F2C94C', '#219653', '#6FCF97', '#2F80ED',\n  '#2D9CDB', '#56CCF2', '#9B51E0'\n]\n\nexport const MAX_LENGTH = 7 * 24 * 60 * 60","import React, { useEffect, useState, useRef } from 'react';\nexport const RefreshImg = ({ src, alt, ...props }: {\n  src: string | null;\n  [rest: string]: any;\n}) => {\n  const [session, setSession] = useState(Date.now());\n  const ref = useRef<number>();\n  useEffect(() => {\n    ref.current = window.setInterval(() => {\n      setSession(Date.now());\n    }, 15 * 1000);\n    return () => {\n      window.clearInterval(ref.current);\n    };\n  }, []);\n  return <img src={`${src}?q=${session}`} alt={alt} {...props} />;\n};\n","import React from 'react'\nimport DataProvider from '../../utils/dataProvider'\n\nimport styles from './Home.module.css'\nimport { API_URL } from 'utils/constants';\nimport { NavLink } from 'react-router-dom';\nimport { RefreshImg } from '../../components/RefreshImg/RefreshImg';\n\nexport default () => {\n  return (\n    <div>\n      <div className={styles.list}>\n        <DataProvider.Consumer>\n          {({ streams }) => streams.map(({ key, name, color }) => (\n            <NavLink to={`/camera/${key}`} className={styles.item}>\n              <section className={styles.header}>\n                <h2 className={styles.name}>{name}</h2>\n                <span className={styles.color} style={{ backgroundColor: color }}></span>\n              </section>\n              <div className={styles.video}>\n                <RefreshImg src={`${API_URL}/frame/${key}`} alt={name} />\n              </div>\n            </NavLink>\n          ))}\n        </DataProvider.Consumer>\n      </div>\n    </div>\n  )\n}","import React, { Component } from 'react'\nimport Hls from 'hls.js'\nimport style from './HLSArchive.module.css'\n\ntype Props = {\n  source: string,\n}\n\nexport default class HLSArchive extends Component<Props> {\n  hls: Hls | null = null\n  timer: number | null  = null\n  ref: HTMLVideoElement | null = null\n\n  componentDidMount() {\n    this.handlePlayback()\n  }\n\n  componentDidUpdate(oldProps: Props) {\n    if (oldProps.source !== this.props.source) {\n      this.handlePlayback()\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.timer !== null) {\n      clearTimeout(this.timer)\n    }\n\n    if (this.ref) {\n      this.ref.pause()\n    }\n    if (this.hls) {\n      this.hls.destroy()\n    }\n  }\n\n  videoRef = (ref: HTMLVideoElement) => {\n    this.ref = ref\n    this.handlePlayback()\n  }\n\n  autoplay: TimerHandler = () => {\n    if (this.ref) this.ref.play()\n  }\n\n  handlePlayback = () => {\n    const { source } = this.props\n\n    console.log(source)\n\n    if (source && this.ref) {\n      if (this.timer !== null) {\n        clearTimeout(this.timer)\n      }\n      \n      if (Hls.isSupported()) {\n        if (this.hls) {\n          this.ref.pause()\n          this.hls.destroy()\n        }\n\n        this.hls = new Hls()\n        this.hls.loadSource(source)\n        this.hls.attachMedia(this.ref)\n        this.hls.on(Hls.Events.MANIFEST_PARSED, () => {\n          this.timer = setTimeout(this.autoplay, 300)\n        })\n      } else {\n        this.ref.src = source\n        this.timer = setTimeout(this.autoplay, 300)\n      }\n    }\n  }\n\n  render() {\n    return <video className={style.video} ref={this.videoRef} autoPlay muted playsInline />\n  }\n}\n","import React, { useRef, useLayoutEffect } from 'react'\n\ntype Props = {\n  delayLog: (delay: number) => any,\n}\n\nexport default ({ delayLog }: Props) => {\n  const videoRef = useRef<HTMLVideoElement>(null)\n\n  useLayoutEffect(() => {\n    if (!videoRef.current) return\n\n    const mediaSource = new MediaSource()\n    const frameBuffer: ArrayBuffer[] = []\n    const media = videoRef.current\n\n    \n    let closing = false\n    let socket: WebSocket | null = null\n    let socketTimer: number | undefined = undefined\n    let sourceBuffer: SourceBuffer | null = null\n    let objectUrl: string | null = null\n    let tickTimer: number | null = null\n    \n    let lastPosition: number = 0\n    let stallTime: number | null = null\n\n    let nudgeRetry = 0\n\n    const nudgePlayback = () => {\n      if (!media) return\n      const currentTime = media.currentTime\n      nudgeRetry += 1;\n\n      const targetTime = currentTime + nudgeRetry * 0.1\n      media.currentTime = targetTime\n    }\n\n    const createSocket = (url: string) => {\n      let sendAck = false\n      socket = new WebSocket(url)\n\n      socket.onopen = () => {\n        socket && socket.send(\"init\")\n      }\n      \n      socket.binaryType = 'arraybuffer'\n      socket.onmessage = ({ data }) => {\n        try {\n          if (!sourceBuffer) return\n          if (sourceBuffer.updating || frameBuffer.length > 0) {\n            frameBuffer.push(data)\n          } else {\n            sourceBuffer.appendBuffer(data)\n          }\n\n          if (sendAck === false && socket != null) {\n            sendAck = true\n            socket.send(\"ack\")\n          }\n        } catch (err) {\n          console.error(err)\n        }\n      }\n      socket.onerror = () => socket && socket.close()\n      socket.onclose = () => {\n        if (closing) return\n        window.clearTimeout(socketTimer)\n        window.setTimeout(() => {\n          \n        }, 1000)\n      }\n    }\n\n    mediaSource.sourceBuffers.addEventListener('addsourcebuffer', () => {\n      createSocket('ws://localhost:8081')\n    })\n\n    mediaSource.addEventListener('sourceopen', () => {\n      mediaSource.duration = 0\n\n      sourceBuffer = mediaSource.addSourceBuffer('video/mp4; codecs=\"avc1.42001f\"')\n      sourceBuffer.mode = \"sequence\"\n      sourceBuffer.onupdateend = () => {\n        if (sourceBuffer && frameBuffer.length > 0 && !sourceBuffer.updating) {\n          console.log('Adding new fragment', frameBuffer.length)\n          const item = frameBuffer.shift()\n          if (item) {\n            console.log('appending item')\n            sourceBuffer.appendBuffer(item)\n          }\n        }\n      }\n      sourceBuffer.onerror = (err) => console.error(err)\n      sourceBuffer.onabort = (err) => console.error(err)\n    })\n\n    objectUrl = window.URL.createObjectURL(mediaSource)\n    media.src = objectUrl\n\n    tickTimer = window.setInterval(() => {\n      if (!sourceBuffer) return\n      const currentPos = media.currentTime\n\n      console.log(media.readyState, media.seekable, media.paused)\n\n      if (currentPos !== lastPosition) {\n        stallTime = null\n        nudgeRetry = 0\n        return\n      }\n\n      if (media.readyState > 2) return\n      if (media.paused) {\n        media.play()\n        return\n      }\n\n      if (!stallTime) {\n        stallTime = performance.now()\n      }\n\n      const stallDuration = window.performance.now() - stallTime\n      if (stallDuration > 1000) {\n        console.log('Nudging playback')\n        nudgePlayback()\n      }\n    }, 100)\n\n    return () => {\n      closing = true\n      if (socket) socket.close()\n      window.clearTimeout(socketTimer)\n      if (tickTimer) window.clearInterval(tickTimer)\n      if (objectUrl) window.URL.revokeObjectURL(objectUrl)\n    }\n  }, [])\n\n  return (\n    <>\n      {/* <button onClick={() => {\n          const blob = new Blob([downloadedData], { type: 'video/mp4' })\n          const objectUrl = window.URL.createObjectURL(blob)\n          window.open(objectUrl)\n      }}>Download</button> */}\n      <div>\n        <video ref={videoRef} controls />\n      </div>\n    </>\n  )\n}","export const vibrateDecorator = (callback: (...args: any) => any) => {\n\treturn (...args: any): any => {\n\t\ttry {\n\t\t\tnavigator.vibrate(200);\n\t\t}\n\t\tcatch (err) { }\n\t\treturn callback(...args);\n\t};\n};\n","import React, { useRef, useLayoutEffect } from 'react'\nimport moment from 'moment'\nimport { useGesture, GestureHandlersPartial } from 'react-use-gesture'\nimport styles from './Slider.module.css'\n\nimport { MAX_LENGTH } from '../../utils/constants'\n\nexport const Slider = ({\n\tvalue,\n\tcolor,\n\tonScrollEnd,\n\tonScroll,\n}: {\n\tvalue: number,\n\tcolor: string,\n\tonScroll: (shift: number) => any,\n\tonScrollEnd: (shift: number) => any,\n}) => {\n\tconst callbackRef = useRef<GestureHandlersPartial>({\n\t\tonDrag: () => {},\n\t\tonDragEnd: () => {},\n\t\tonWheel: () => {},\n\t\tonWheelEnd: () => {},\n\t})\n\n\tconst canvasRef = useRef<HTMLCanvasElement>(null)\n\tconst bind = useGesture({\n\t\tonWheel: (event) => {\n\t\t\tif (callbackRef.current.onWheel) {\n\t\t\t\tcallbackRef.current.onWheel(event)\n\t\t\t}\n\t\t},\n\t\tonWheelEnd: (event: any) => {\n\t\t\tif (callbackRef.current.onWheelEnd) {\n\t\t\t\tcallbackRef.current.onWheelEnd(event)\n\t\t\t}\n\t\t},\n\t\tonDrag: (event) => {\n\t\t\tif (callbackRef.current.onDrag) {\n\t\t\t\tcallbackRef.current.onDrag(event)\n\t\t\t}\n\t\t},\n\t\tonDragEnd: (event: any) => {\n\t\t\tif (callbackRef.current.onDragEnd) {\n\t\t\t\tcallbackRef.current.onDragEnd(event)\n\t\t\t}\n\t\t},\n\t})\n\n\tuseLayoutEffect(() => {\n\t\tlet animationId: number | null = null\n\t\t// the idea: we don't need to specify the day, it should be resolved by itself.\n\t\t// just make sure we don't draw outside the canvas\n\n\t\t// offset of the slider caused by value\n\t\tconst valueOffset = -Math.floor(value / 1000) \n\n\t\t// offset set temporarily during scrolling\n\t\tlet userOffset = 0\n\n\t\tconst draw = (canvas: HTMLCanvasElement | null) => {\n\t\t\tif (!canvas || !canvas.parentElement) return\n\t\t\tconst ctx = canvas.getContext('2d')\n\t\t\tif (!ctx) return\n\t\t\t\n\t\t\tconst parentRect = canvas.parentElement.getBoundingClientRect()\n\t\t\tcanvas.width = parentRect.width\n\t\t\tcanvas.height = parentRect.height\n\n\t\t\t// draws the line, receving arguments as px, not relative to time\n\t\t\tconst drawLine = (xFrom: number, xTo: number, viewOffset: number = 0) => {\n\t\t\t\tconst { width, height } = canvas.getBoundingClientRect()\n\t\t\t\t\n\t\t\t\tctx.lineWidth = 10\n\t\t\t\tctx.strokeStyle = color\n\n\t\t\t\tctx.beginPath()\n\t\t\t\tctx.moveTo(Math.min(width, Math.max(0, xFrom + viewOffset)), height / 2)\n\t\t\t\tctx.lineTo(Math.min(width, Math.max(0, xTo + viewOffset)), height / 2)\n\t\t\t\tctx.closePath()\n\t\t\t\tctx.stroke()\n\t\t\t}\t\n\t\t\t\n\t\t\t// hide progress bar when necessary\n\t\t\tconst drawDayBoundedLine = (shift: number) => {\n\t\t\t\tconst { width } = canvas.getBoundingClientRect()\n\n\t\t\t\tconst now = moment()\n\t\t\t\tconst shiftedNow = now.clone().add(shift, 'seconds')\n\t\t\t\tconst startDayX = Math.min(MAX_LENGTH, now.diff(shiftedNow.clone().startOf('day'), 'second'))\n\t\t\t\tconst endDayX = Math.max(0, now.diff(shiftedNow.clone().endOf('day'), 'second'))\n\n\t\t\t\tdrawLine(endDayX + shift, startDayX + shift, width / 2)\n\t\t\t}\n\t\t\n\t\t\tdrawDayBoundedLine(valueOffset + userOffset)\n\t\t}\n\n\n\t\tconst tick = () => {\n\t\t\tdraw(canvasRef.current)\n\t\t\tanimationId = window.requestAnimationFrame(tick)\n\t\t}\n\n\t\tconst handleScroll = (delta: number) => {\n\t\t\tuserOffset = delta\n\n\t\t\t// limit userOffset to be in range of <-MAX_LENGTH_IN_SECONDS, 0>, as userOffset is negative in nature\n\t\t\t// (valueOffset + userOffset) <= 0 && (valueOffset + userOffset) >= -MAX_LENGTH_IN_SECONDS\n\t\t\tuserOffset = Math.min(-valueOffset, Math.max(-MAX_LENGTH - valueOffset, userOffset))\n\t\n\t\t\t// onScroll assumes offset in ms\n\t\t\tonScroll(-(valueOffset + userOffset) * 1000)\n\t\t}\n\n\t\tconst handleScrollEnd = () => {\n\t\t\tonScrollEnd(-(valueOffset + userOffset) * 1000)\n\t\t}\n\n\t\tcallbackRef.current = {\n\t\t\tonDrag: (event) => handleScroll(event.delta[0]),\n\t\t\tonWheel: (event: any) => handleScroll(-event.delta[0] || event.delta[1]),\n\t\t\tonDragEnd: () => handleScrollEnd(),\n\t\t\tonWheelEnd: () => handleScrollEnd(),\n\t\t}\n\n\t\ttick()\n\n\t\treturn () => {\n\t\t\tif (animationId) window.cancelAnimationFrame(animationId)\n\t\t}\n\t}, [value, color])\n\n\treturn (\n\t\t<div className={styles.canvas}>\n\t\t\t<canvas\n\t\t\t\tref={canvasRef}\n\t\t\t\theight={100}\n\t\t\t\t{...bind()}\n\t\t\t/>\n\t\t</div>\n\t)\n}\n\nexport default Slider\n","import React, { useRef, useLayoutEffect, useState, useEffect } from 'react'\nimport moment from 'moment'\n\nimport { vibrateDecorator } from '../../utils/vibrateDecorator'\nimport styles from './Scrobber.module.css'\nimport { NavLink } from 'react-router-dom'\nimport { Slider } from '../Slider/Slider'\n\nimport { MAX_LENGTH } from '../../utils/constants'\n\nconst formatTime = (time: number) => {\n  const absTime = Math.abs(time)\n\n  const seconds = Math.floor(absTime / 1000) % 60\n  const minutes = Math.floor(absTime / 1000 / 60) % 60\n\tconst hours = Math.floor(absTime / 1000 / 60 / 60) % 24\n\tconst days = Math.floor(absTime / 1000 / 60 / 60 / 24)\n\t\n\tlet result = []\n\tif (seconds > 0 || minutes > 0 || hours > 0) {\n\t\tresult.unshift(`${seconds.toFixed(0).padStart(2, '0')}s`)\n\t}\n\n  if (minutes > 0 || hours > 0) {\n    result.unshift(`${minutes.toFixed(0).padStart(2, '0')}m`)\n  }\n  if (hours > 0) {\n    result.unshift(`${hours.toFixed(0).padStart(2, '0')}h`)\n\t}\n\t\n\tif (days > 0) {\n\t\tresult.unshift(`${days}d`)\n\t}\n\n  return `${Math.sign(time) < 0 ? '-' : ''}${result.join(' ')}`\n}\n\nexport const useTimer = (callback: (now: number) => any) => {\n\tuseLayoutEffect(() => {\n\t\tlet timer: number | null = null\n\n\t\tconst tick = () => {\n\t\t\tconst now = Date.now()\n\t\t\tcallback(now)\n\t\t\tif (timer !== null) window.clearTimeout(timer)\n\t\t\ttimer = window.setTimeout(tick, Math.max(1000 - new Date(now).getMilliseconds(), 0))\n\t\t}\n\t\ttick()\n\t\t\n\t\treturn () => {\n\t\t\tif (timer !== null) window.clearTimeout(timer)\n\t\t}\n\t}, [])\n}\n\nconst useVisibleTimer = (delay = 1000) => {\n\tconst [visible, setVisible] = useState(true)\n\tconst show = useRef<() => any>(() => setVisible(true))\n\tconst hide = useRef<() => any>(() => setVisible(false))\n\n\tuseEffect(() => {\n\t\tlet timer: number | null = null\n\n\t\thide.current = () => {\n\t\t\tif (timer !== null) window.clearTimeout(timer)\n\t\t\tsetVisible(false)\n\t\t}\n\n\t\tshow.current = () => {\n\t\t\tif (timer !== null) window.clearTimeout(timer)\n\t\t\tsetVisible(true)\n\t\t\ttimer = window.setTimeout(hide.current, delay)\n\t\t}\n\n\t\tshow.current()\n\n\t\treturn () => {\n\t\t\tif (timer !== null) window.clearTimeout(timer)\n\t\t}\n\t}, [delay])\n\n\treturn { visible, show, hide }\n}\n\nconst Scrobber = ({\n\tonShift,\n\tstream,\n}: {\n\tonShift: (shift: number) => void,\n\tstream: {\n\t\tkey: string,\n\t\tname: string,\n\t\tcolor: string,\n\t}\n}) => {\n\n\tconst [current, setCurrent] = useState(Date.now())\n\tconst [shift, setShift] = useState(0)\n\tconst [commitedShift, setCommitedShift] = useState(0)\n\n\tconst callbacks = useRef<{\n\t\tcommitShift?: (newShift: number, noWait: boolean) => any,\n\t\tscrollChange?: (shift: number) => any,\n\t\ttimeChange?: (value: string) => any,\n\t\tdateChange?: (value: Date | null) => any,\n\t}>({})\n\n\tconst { visible, show, hide } = useVisibleTimer(10 * 1000)\n\n\tuseTimer((now) => setCurrent(now))\n\n\tuseEffect(() => {\n\t\tlet handleTimeout: number | null = null\n\t\tcallbacks.current.commitShift = (newShift: number, noWait = false) => {\n\t\t\tconst shift = Math.max(0, Math.min(MAX_LENGTH * 1000, newShift))\n\t\t\tsetShift(shift)\n\t\n\t\t\tif (handleTimeout) window.clearTimeout(handleTimeout)\n\t\t\tif (!noWait) {\n\t\t\t\thandleTimeout = window.setTimeout(() => {\n\t\t\t\t\tsetCommitedShift(shift)\n\t\t\t\t\tonShift(Math.ceil(shift / 1000))\n\t\t\t\t}, 100)\n\t\t\t} else {\n\t\t\t\tsetCommitedShift(shift)\n\t\t\t\tonShift(Math.ceil(shift / 1000))\n\t\t\t}\n\t\t}\n\n\t\tcallbacks.current.scrollChange = (shift: number) => {\n\t\t\tif (callbacks.current.commitShift) callbacks.current.commitShift(shift, true)\n\t\t}\n\t\n\t\tcallbacks.current.timeChange = (value: string) => {\n\t\t\tconst [hours, minutes] = value.split(':').map(item => Number.parseInt(item, 10))\n\t\t\tconsole.log(hours,minutes)\n\t\t\tconst now = moment()\n\t\t\tconst past = now.clone().subtract(commitedShift, 'milliseconds')\n\t\t\t\t.hours(hours)\n\t\t\t\t.minutes(minutes)\n\t\n\t\t\tif (callbacks.current.commitShift) callbacks.current.commitShift(now.diff(past), true)\n\t\t}\n\t\t\n\t\tcallbacks.current.dateChange = (value: Date | null) => {\n\t\t\tif (!value) return\n\t\t\tconst now = moment()\n\t\t\tconst ref = moment().subtract(commitedShift, 'milliseconds')\n\t\t\tconst past = moment(value)\n\t\t\t\t.hours(ref.hours())\n\t\t\t\t.minutes(ref.minutes())\n\t\t\t\t.seconds(ref.seconds())\n\t\t\t\t.milliseconds(ref.milliseconds())\n\t\n\t\t\tconsole.log(commitedShift, past.format('YYYY-MM-DD HH:mm:ss'))\n\t\t\tif (callbacks.current.commitShift) callbacks.current.commitShift(now.diff(past), true)\n\t\t}\n\n\t\treturn () => {\n\t\t\tif (handleTimeout) window.clearTimeout(handleTimeout)\n\t\t}\n\n\t}, [commitedShift])\n\n\tconst date = moment(new Date(current - shift))\n\n\tlet minRangeRounded = current - MAX_LENGTH * 1000\n\tminRangeRounded -= minRangeRounded % (60 * 1000)\n\n\tlet maxRangeRounded = current\n\tmaxRangeRounded += (60 * 1000) - maxRangeRounded % (60 * 1000)\n\n\tconst minDate = moment(new Date(minRangeRounded))\n\tconst maxDate = moment(new Date(maxRangeRounded))\n\n\treturn (\n\t\t<div\n\t\t\tclassName={styles.main}\n\t\t\tstyle={{ opacity: visible ? 1 : 0 }}\n\t\t\tonTouchStart={show.current}\n\t\t\tonMouseMove={show.current}\n\t\t>\n\t\t\t<div className={styles.top}>\n\t\t\t\t<NavLink to=\"/\" className={styles.back}>\n\t\t\t\t\t<svg viewBox=\"0 0 29 21\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t<path d=\"M25 9.17424V11.8258H9.09091L16.3826 19.1174L14.5 21L4 10.5L14.5 0L16.3826 1.88258L9.09091 9.17424H25Z\" fill=\"currentColor\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</NavLink>\n\t\t\t\t<div className={styles.info}>\n\t\t\t\t\t<span className={styles.color} style={{ backgroundColor: stream && stream.color }}></span>\n\t\t\t\t\t<span className={styles.name}>{stream && stream.name}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className={styles.timeline}>\n\t\t\t\t<div className={styles.center}>\n\t\t\t\t\t<div className={[styles.timewrapper].join(' ')}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tonClick={() => callbacks.current.scrollChange && vibrateDecorator(callbacks.current.scrollChange)(0)}\n\t\t\t\t\t\t\tclassName={[styles.timeoffset].join(' ')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{!shift ? <span className={[styles.live].join(' ')}>Živě</span> : formatTime(-shift)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className={[styles.pill, styles.margin].join(' ')}>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclassName={styles.cover}\n\t\t\t\t\t\t\t\tonChange={(e) => callbacks.current.timeChange && vibrateDecorator(callbacks.current.timeChange)(e.target.value)}\n\t\t\t\t\t\t\t\tvalue={date.format('HH:mm')}\n\t\t\t\t\t\t\t\tmin={minDate.format('HH:mm')}\n\t\t\t\t\t\t\t\tmax={maxDate.format('HH:mm')}\n\t\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<span className={[styles.time].join(' ')}>{date.format('HH:mm:ss')}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className={[styles.pill].join(' ')}>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclassName={styles.cover}\n\t\t\t\t\t\t\tonChange={(e) => callbacks.current.dateChange && vibrateDecorator(callbacks.current.dateChange)(e.target.valueAsDate)}\n\t\t\t\t\t\t\tvalue={date.format('YYYY-MM-DD')}\n\t\t\t\t\t\t\tmin={minDate.format('YYYY-MM-DD')}\n\t\t\t\t\t\t\tmax={maxDate.format('YYYY-MM-DD')}\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className={[styles.calendar].join(' ')}>{date.format('DD. MMMM YYYY')}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Slider\n\t\t\t\tonScroll={(shift) => setShift(shift)}\n\t\t\t\tonScrollEnd={(shift) => callbacks.current.scrollChange && vibrateDecorator(callbacks.current.scrollChange)(shift)}\n\t\t\t\tvalue={commitedShift}\n\t\t\t\tcolor={stream.color}\n\t\t\t/>\n\t\t</div>\n\t)\n}\n\nexport default Scrobber","import React, { Component } from 'react'\n\nimport styles from './Camera.module.css'\nimport Dvr from '../../components/HLSArchive/HLSArchive'\nimport MediaSourceLive from '../../components/MediaSourceLive/MediaSourceLive'\nimport Scrobber from '../../components/Scrobber/Scrobber'\n\nimport { API_URL } from '../../utils/constants'\n\ntype Props = {\n  name: string,\n  streams: {\n    key: string,\n    name: string,\n    color: string,\n  }[],\n}\n\ntype State = {\n  from: number,\n  to: number,\n  shift: number,\n  debugDelay: number,\n  showTools: boolean,\n}\n\nexport default class Camera extends Component<Props, State> {\n  state: State = {\n    from: 0,\n    to: 0,\n    shift: 0,\n    debugDelay: 0,\n    showTools: false,\n  }\n  \n  generateUrl = ({ name, from, to, shift }: { name: string, from: number, to: number, shift: number }): string | null => {\n    // if (!shift && !from && !to) return null\n    \n    let baseUrl = `${API_URL}/data/${name}/`\n    let type = 'stream.m3u8'\n\n    let params = []\n    if (from > 0) {\n      type = 'slice.m3u8'\n      params.push(`from=${from}`)\n\n      if (to > 0 && from < to) {\n        params.push(`to=${to}`)\n      }\n    } else if (shift > 0) {\n      params.push(`shift=${shift}`)\n    }\n\n    baseUrl += type\n    if (params.length > 0) {\n      baseUrl += '?' + params.join('&')\n    }\n\n    return baseUrl\n  }\n\n  componentWillUpdate(newProps: Props) {\n    if (this.props.name !== newProps.name) {\n      this.setState({ from: 0, to: 0, shift: 0 })\n    }\n  }\n\n  handleShiftChange = (shift: number) => {\n    console.log(shift)\n    this.setState({ shift })\n  }\n\n  render() {\n    const { name, streams } = this.props\n    const { from, to, shift, debugDelay } = this.state\n    const url = this.generateUrl({ name, from, to, shift })\n\n    const stream = streams.find(({ key }) => key === name)\n\n    return (\n      <div className={styles.camera}>\n        { url && <Dvr source={url} /> }\n        { !url && <MediaSourceLive delayLog={(add: number) => {\n          this.setState({ debugDelay: this.state.debugDelay + add })\n        }} /> }\n        { stream && <Scrobber onShift={this.handleShiftChange} stream={stream} /> }\n      </div>\n    )\n  }\n}\n","import React, { useState, useEffect } from 'react'\nimport { BrowserRouter as Router, Route, RouteComponentProps } from 'react-router-dom'\n\nimport Home from './routes/Home/Home'\nimport Camera from './routes/Camera/Camera'\n\nimport { API_URL, COLORS } from './utils/constants'\nimport DataContext from './utils/dataProvider'\n\n\nconst App = () => {\n\tconst [streams, setStreams] = useState([])\n\t\t\n\tuseEffect(() => {\n\t\tfetch(`${API_URL}/streams`).then((a) => a.json()).then(({ data }) => setStreams(data.map((item: any, index: number) => ({ ...item, color: COLORS[index % COLORS.length] }))))\n\t}, [])\n\n\treturn (\n\t\t<Router>\n\t\t\t<DataContext.Provider value={{ streams }}>\n\t\t\t\t<div id=\"app\">\n\t\t\t\t\t<Route exact path=\"/\" component={Home} />\n\t\t\t\t\t<Route path=\"/camera/:name\" render={({ match }: RouteComponentProps<{ name: string }>) => (<Camera name={match.params.name} streams={streams} />)} />\n\t\t\t\t</div>\n\t\t\t</DataContext.Provider>\n\t\t</Router>\n\t)\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}