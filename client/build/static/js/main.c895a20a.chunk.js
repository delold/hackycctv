(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports={timeline:"Scrobber_timeline__2QMUb",scrobber:"Scrobber_scrobber__13cT7",slider:"Scrobber_slider__2qtzj",day:"Scrobber_day__3V_gH",position:"Scrobber_position__21tsl",bubble:"Scrobber_bubble__1Z5Vj",button:"Scrobber_button__2QFrl",hidden:"Scrobber_hidden__3BlCq"}},13:function(e,t,n){e.exports={header:"Menu_header__13Hex",active:"Menu_active__1QS5y",btn:"Menu_btn__2c26E",hide:"Menu_hide__1klpX"}},26:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){e.exports=n(43)},33:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(23),c=n.n(r),i=(n(33),n(2)),s=n(3),l=n(5),u=n(4),f=n(6),h=n(14),m=n(10),d=n(13),p=n.n(d),v=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={showMenu:!1},n.handleOnMenu=function(){try{navigator.vibrate(100)}catch(e){}n.setState({showMenu:!n.state.showMenu})},n.enableNoSleep=function(){try{navigator.vibrate(100)}catch(e){}n.handleOnMenu()},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return o.a.createElement("header",{className:p.a.header},o.a.createElement("h1",null,"Kamera"),o.a.createElement("nav",{className:this.state.showMenu?void 0:p.a.hide},this.props.streams.map(function(e){var t=e.name,n=e.key;return o.a.createElement(h.b,{activeClassName:p.a.active,to:"/camera/".concat(n),key:n},t)})),o.a.createElement("a",{className:p.a.btn,onClick:this.handleOnMenu},"\u2630"))}}]),t}(a.Component),b=function(){return o.a.createElement("div",null,"Home")},y=n(26),k=n.n(y),S=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).ms=null,n.video=null,n.objectUrl=null,n.socket=null,n.socketTimeout=null,n.frameBuffer=[],n.socketConnect=function(){n.socket=new WebSocket(n.props.source),n.socket.binaryType="arraybuffer",n.socket.onopen=function(){return console.log("open connection")},n.socket.onmessage=function(e){var t=e.data;n.frameBuffer.push(new Uint8Array(t)),n.doAppend(),n.video&&n.video.paused&&n.video.play()},n.socket.onerror=function(){console.log("error in socket"),n.socket&&n.socket.close()},n.socket.onclose=function(){console.log("closing socket"),null!==n.socketTimeout&&clearTimeout(n.socketTimeout);n.socketTimeout=setTimeout(function(){return n.socketConnect()},1e3)}},n.onUpdateEnd=function(){n.doAppend()},n.doAppend=function(){if(n.frameBuffer&&n.frameBuffer.length>0){var e=n.frameBuffer.shift();if(n.ms&&e&&n.ms.sourceBuffers[0]){var t=n.ms.sourceBuffers[0];t.updating||t.appendBuffer(e)}}},n.onSourceOpen=function(){(console.log("source open"),n.ms)&&(n.ms.addSourceBuffer("video/mp4;codecs=avc1.42001f").addEventListener("updateend",n.onUpdateEnd),n.socketConnect())},n.onRef=function(e){n.video=e,n.video&&(n.objectUrl?n.video.src=n.objectUrl:n.createDecoder())},n.createDecoder=function(){n.props.source&&(n.ms=new MediaSource,n.ms.addEventListener("sourceopen",n.onSourceOpen,!1),n.objectUrl=window.URL.createObjectURL(n.ms),n.video&&(n.video.src=n.objectUrl))},n.destroyDecoder=function(){if(null!==n.socketTimeout&&clearTimeout(n.socketTimeout),n.socket&&(n.socket.onclose=function(){return console.log("closing socket without reconnect")},n.socket.close()),n.video&&(n.video.removeAttribute("src"),n.video.load()),n.objectUrl&&URL.revokeObjectURL(n.objectUrl),n.ms){try{n.ms.endOfStream()}catch(e){}n.ms.removeEventListener("sourceopen",n.onSourceOpen)}n.ms=null,n.objectUrl=null},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){e.source!==this.props.source&&(this.destroyDecoder(),this.createDecoder())}},{key:"componentWillUnmount",value:function(){this.destroyDecoder()}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("video",{ref:this.onRef}))}}]),t}(a.Component),O=n(15),g=n.n(O),j=n(27),T=n.n(j),E=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).hls=null,n.timer=null,n.ref=null,n.videoRef=function(e){n.ref=e,n.handlePlayback()},n.autoplay=function(){n.ref&&n.ref.play()},n.handlePlayback=function(){var e=n.props.source;e&&n.ref&&(null!==n.timer&&clearTimeout(n.timer),g.a.isSupported()?(n.hls&&(n.ref.pause(),n.hls.destroy()),n.hls=new g.a,n.hls.loadSource(e),n.hls.attachMedia(n.ref),n.hls.on(g.a.Events.MANIFEST_PARSED,function(){n.timer=setTimeout(n.autoplay,300)})):(n.ref.src=e,setTimeout(n.autoplay,300)))},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.handlePlayback()}},{key:"componentDidUpdate",value:function(e){e.source!==this.props.source&&this.handlePlayback()}},{key:"componentWillUnmount",value:function(){null!==this.timer&&clearTimeout(this.timer),this.ref&&this.ref.pause(),this.hls&&this.hls.destroy()}},{key:"render",value:function(){return o.a.createElement("video",{className:T.a.video,ref:this.videoRef,autoPlay:!0,muted:!0,playsinline:!0})}}]),t}(a.Component),w=n(11),_=n.n(w),M=n(18),U=n.n(M),x=864e5,P=7*x,D=10,L=3e4,C=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).canvas=null,n.timeToPx=function(e){return e/L},n.timestampToPx=function(e){var t=n.props.current;return n.timeToPx(t-e)},n.getRef=function(e){n.canvas=e,n.draw()},n.draw=function(){var e=n.props,t=e.current,a=e.scenes;if(n.canvas&&t){var o=n.canvas.getContext("2d");if(o){var r=n.timeToPx(P);n.canvas.width=r,n.canvas.height=70,o.lineWidth=1,o.strokeStyle="#ff00ff",o.beginPath(),o.moveTo(0,35),a.forEach(function(e){var t=e.timestamp,a=e.scene,r=n.timestampToPx(1e3*t),c=33.5-33.5*a;o.lineTo(r,c)}),o.stroke(),o.lineWidth=3,o.strokeStyle="#fff",o.fillStyle="#fff",o.textBaseline="bottom",o.font="16px sans-serif";for(var c=t,i=t-P,s=0;c-s>=i;){var l=c-U()(c).startOf("day").valueOf(),u=n.timeToPx(s),f=n.timeToPx(s+l);o.beginPath(),o.arc(f,35,10,0,2*Math.PI),o.closePath(),o.stroke(),o.font="1em sans-serif",o.fillText(U()(c).format("YYYY-MM-DD"),u+(s&&10)+5,28.5),o.beginPath(),o.moveTo(u+(s&&10),35),o.lineTo(f-10,35),o.closePath(),o.stroke(),s+=l}}}},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.draw()}},{key:"shouldComponentUpdate",value:function(e){return e.current!==this.props.current||e.scenes.length!==this.props.scenes.length}},{key:"componentDidUpdate",value:function(){this.draw()}},{key:"render",value:function(){return o.a.createElement("canvas",{ref:this.getRef})}}]),t}(a.Component),A=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).debounce=null,n.interval=null,n.timeout=null,n.sceneTimer=null,n.timer=null,n.ref=null,n.state={shift:0,current:Date.now(),paused:!1,visible:!0,scenes:[]},n.onShift=function(e){n.debounce&&clearTimeout(n.debounce);n.debounce=setTimeout(function(){n.props.onShift(Math.ceil(e/1e3))},200)},n.performTick=function(){n.interval||(n.interval=0);var e=Date.now();n.setState({current:e}),null!==n.timer&&clearTimeout(n.timer);var t=n.performTick;n.timer=setTimeout(t,Math.max(1e3-new Date(e).getMilliseconds(),0))},n.extendOpacity=function(){n.setState({visible:!0}),n.timeout&&clearTimeout(n.timeout);n.timeout=setTimeout(function(){return n.setState({visible:!1})},8e3)},n.handleScroll=function(){if(n.extendOpacity(),n.ref&&!n.state.paused){var e=n.ref.scrollLeft*L;n.setState({shift:e}),n.onShift(e)}},n.addRef=function(e){n.ref=e,n.ref&&n.ref.addEventListener("scroll",n.handleScroll)},n.handleLive=function(){try{navigator.vibrate(100)}catch(e){}n.ref&&(n.ref.scrollLeft=0,n.setState({paused:!1,shift:0}),n.onShift(0))},n.handlePlayPause=function(){var e=n.state,t=e.paused,a=e.current,o=e.shift;try{navigator.vibrate(100)}catch(c){}if(t){var r=o+(Date.now()-a);n.setState({paused:!1,shift:r}),n.performTick(),n.ref&&(n.ref.scrollLeft=r/x*n.ref.offsetWidth*D),n.onShift(r)}else n.setState({paused:!0}),n.props.onStop()},n.handleShift=function(e){var t=1e3*e/L;n.ref&&(n.ref.scrollLeft=Math.max(0,Math.min(P/L,n.ref.scrollLeft+t)))},n.handleShiftRight=function(){return n.handleShift(30)},n.handleShiftLeft=function(){return n.handleShift(-30)},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.extendOpacity(),document.addEventListener("touchstart",this.extendOpacity),document.addEventListener("mousedown",this.extendOpacity),document.addEventListener("mousemove",this.extendOpacity),this.performTick()}},{key:"componentWillUnmount",value:function(){this.ref&&this.ref.removeEventListener("scroll",this.handleScroll),document.removeEventListener("mousedown",this.extendOpacity),this.timer&&clearTimeout(this.timer),this.debounce&&clearTimeout(this.debounce),this.timeout&&clearTimeout(this.timeout),this.sceneTimer&&clearTimeout(this.sceneTimer)}},{key:"render",value:function(){var e=this.state,t=e.current,n=e.shift,a=(e.paused,e.visible),r=e.scenes;return o.a.createElement("div",{className:_.a.timeline,style:{opacity:a?1:0}},o.a.createElement("div",{className:_.a.position},o.a.createElement("div",{className:_.a.button,onClick:this.handleShiftLeft},"\u23ea"),o.a.createElement("div",{className:_.a.bubble},new Date(t-n).toLocaleString()),o.a.createElement("div",{className:_.a.button,onClick:this.handleShiftRight},"\u23e9")),o.a.createElement("div",{className:_.a.scrobber,ref:this.addRef},o.a.createElement(C,{current:t,scenes:r})))}}]),t}(a.Component),R="http://".concat("doma.duong.cz",":8082"),N=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={from:0,to:0,shift:0,showTools:!1},n.generateUrl=function(e){var t=e.name,n=e.from,a=e.to,o=e.shift;if(!o&&!n&&!a)return null;var r="".concat(R,"/data/").concat(t,"/"),c="stream.m3u8",i=[];return n>0?(c="slice.m3u8",i.push("from=".concat(n)),a>0&&n<a&&i.push("to=".concat(a))):o>0&&i.push("shift=".concat(o)),r+=c,i.length>0&&(r+="?"+i.join("&")),r},n.handlePause=function(){console.log("handling pause")},n.handleShiftChange=function(e){console.log(e),n.setState({shift:e})},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentWillUpdate",value:function(e){this.props.name!==e.name&&this.setState({from:0,to:0,shift:0})}},{key:"render",value:function(){var e=this.props.name,t=this.state,n=t.from,a=t.to,r=t.shift,c=this.generateUrl({name:e,from:n,to:a,shift:r});return o.a.createElement("div",{className:k.a.camera},c&&0===c.indexOf("http")&&o.a.createElement(E,{source:c}),c&&0===c.indexOf("ws")&&o.a.createElement(S,{source:c}),o.a.createElement(A,{onShift:this.handleShiftChange,onStop:this.handlePause,name:e}))}}]),t}(a.Component),B=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={streams:[]},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("".concat(R,"/streams"),{headers:{Authorization:"Basic ".concat(btoa("duong.cz:1974hoangdathongvinhvinhhongdathoang1303"))},credentials:"include"}).then(function(e){return e.json()}).then(function(t){var n=t.data;e.setState({streams:n})})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{id:"app"},o.a.createElement(v,{streams:this.state.streams}),o.a.createElement(h.a,null,o.a.createElement(m.a,{path:"/",component:b}),o.a.createElement(m.a,{path:"/camera/:name",render:function(t){var n=t.match;return o.a.createElement(N,{name:n.params.name,streams:e.state.streams})}})))}}]),t}(a.Component);c.a.render(o.a.createElement(B,null),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.c895a20a.chunk.js.map